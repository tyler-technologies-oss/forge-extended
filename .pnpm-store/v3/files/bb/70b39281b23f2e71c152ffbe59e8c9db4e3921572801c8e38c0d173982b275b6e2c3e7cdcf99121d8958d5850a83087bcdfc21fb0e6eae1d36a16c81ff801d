import { BOTTOM_SHEET_CONSTANTS } from '@tylertech/forge';
import { useDynamicForgeComponent } from './useDynamicForgeComponent';
const BOTTOM_SHEET_ANIMATION_DURATION = 300;
export const useForgeBottomSheet = (component, componentProps) => {
    const delegate = {
        show: instance => {
            document.body.appendChild(instance); // TODO: make the parent element configurable
            instance.open = true;
        },
        // eslint-disable-next-line arrow-body-style
        hide: (instance, cb) => {
            return new Promise(resolve => {
                const complete = () => {
                    instance.remove();
                    if (typeof cb === 'function') {
                        cb();
                    }
                    resolve();
                };
                if (!instance.open) {
                    complete();
                    return;
                }
                instance.open = false;
                window.setTimeout(() => complete(), BOTTOM_SHEET_ANIMATION_DURATION);
            });
        }
    };
    const controller = useDynamicForgeComponent('forge-bottom-sheet', component, componentProps, delegate);
    function show({ bottomSheetAttributes, bottomSheetClass, ...options } = {}, dismissCallback) {
        const bottomSheetElement = controller.show(options);
        if (bottomSheetAttributes) {
            bottomSheetAttributes.forEach((value, key) => bottomSheetElement.setAttribute(key, value));
        }
        if (bottomSheetClass) {
            bottomSheetElement.classList.add(bottomSheetClass);
        }
        bottomSheetElement.addEventListener(BOTTOM_SHEET_CONSTANTS.events.CLOSE, () => {
            controller.hide();
            if (typeof dismissCallback === 'function') {
                dismissCallback();
            }
        });
        return bottomSheetElement;
    }
    return [show, controller.hide];
};
