import { Directive, Input, TemplateRef } from '@angular/core';
import { POPOVER_CONSTANTS, PopoverComponent } from '@tylertech/forge';
import * as i0 from "@angular/core";
/**
 * Allows for declaratively specifying an element that should display a Forge popover
 * from the provided `TemplateRef`.
 */
export class PopoverDirective {
    /**
     * @deprecated Use static property instead.
     */
    set forgePopoverCloseOnBlur(value) {
        this.persistent = !value;
    }
    get popoverElement() {
        return this._popoverElement;
    }
    constructor(_elementRef, _viewContainerRef) {
        this._elementRef = _elementRef;
        this._viewContainerRef = _viewContainerRef;
        /** The popover placement around the `ElementRef`. */
        this.forgePopoverPlacement = 'bottom';
        /** Controls whether the popover closes when it loses focus. */
        this.persistent = false;
        this._elementRef.nativeElement.addEventListener(POPOVER_CONSTANTS.events.TOGGLE, () => {
            window.requestAnimationFrame(() => this.close());
        });
    }
    /** Creates and renders a TemplateRef inside of a Forge popover. */
    open() {
        if (this._popoverElement) {
            return;
        }
        // Ensure that we have a popover template
        if (this.forgePopover instanceof TemplateRef === false) {
            throw new Error('Popover template is not defined.');
        }
        // Create the embedded view from the template
        this._contentRef = this._viewContainerRef.createEmbeddedView(this.forgePopover);
        if (this._contentRef.rootNodes[0] instanceof PopoverComponent) {
            // <forge-popover> element is supplied in the template
            this._popoverElement = this._contentRef.rootNodes[0];
            this._popoverElement.remove();
        }
        else {
            // Create the Forge popover element
            this._popoverElement = document.createElement('forge-popover');
            // Because createEmbeddedView will place the template within the element defined by ViewContainerRef, we
            // need to then move the elements to children of the Forge popover element so they render within the popover
            this._contentRef.rootNodes.forEach(node => this._popoverElement?.appendChild(node));
            this._popoverElement.placement = this.forgePopoverPlacement;
            // Add the custom class (if provided)
            if (this.forgePopoverClass) {
                this._popoverElement.classList.add(this.forgePopoverClass);
            }
            this._popoverElement.persistent = this.persistent;
        }
        let hostElement = this._elementRef.nativeElement.closest(POPOVER_CONSTANTS.selectors.HOST);
        if (!hostElement) {
            const rootNode = this._elementRef.nativeElement.getRootNode();
            const hostRootNode = rootNode instanceof ShadowRoot ? rootNode : (this._elementRef.nativeElement.ownerDocument ?? document).body;
            hostElement = hostRootNode;
        }
        hostElement.appendChild(this._popoverElement);
        this._popoverElement.anchorElement = this._elementRef.nativeElement;
        this._popoverElement.open = true;
    }
    /** Closes the Forge popover and destroys the embedded view. */
    close() {
        if (this._popoverElement) {
            this._popoverElement.open = false;
            this._popoverElement = undefined;
        }
        if (this._contentRef) {
            this._contentRef.destroy();
            this._contentRef = undefined;
        }
    }
    ngOnDestroy() {
        this.close();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.7", ngImport: i0, type: PopoverDirective, deps: [{ token: i0.ElementRef }, { token: i0.ViewContainerRef }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "17.3.7", type: PopoverDirective, selector: "[forgePopover]", inputs: { forgePopover: "forgePopover", forgePopoverPlacement: "forgePopoverPlacement", forgePopoverCloseOnBlur: "forgePopoverCloseOnBlur", persistent: "persistent", forgePopoverClass: "forgePopoverClass" }, exportAs: ["forgePopover"], ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.7", ngImport: i0, type: PopoverDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[forgePopover]',
                    exportAs: 'forgePopover'
                }]
        }], ctorParameters: () => [{ type: i0.ElementRef }, { type: i0.ViewContainerRef }], propDecorators: { forgePopover: [{
                type: Input
            }], forgePopoverPlacement: [{
                type: Input
            }], forgePopoverCloseOnBlur: [{
                type: Input
            }], persistent: [{
                type: Input
            }], forgePopoverClass: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9mb3JnZS1hbmd1bGFyL3NyYy9saWIvcG9wb3Zlci9wb3BvdmVyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBYyxXQUFXLEVBQW9CLE1BQU0sZUFBZSxDQUFDO0FBRTVGLE9BQU8sRUFBRSxpQkFBaUIsRUFBb0IsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7QUFFekY7OztHQUdHO0FBS0gsTUFBTSxPQUFPLGdCQUFnQjtJQVkzQjs7T0FFRztJQUNILElBQ1csdUJBQXVCLENBQUMsS0FBYztRQUMvQyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsS0FBSyxDQUFDO0lBQzNCLENBQUM7SUFVRCxJQUFXLGNBQWM7UUFDdkIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDO0lBQzlCLENBQUM7SUFFRCxZQUNVLFdBQW9DLEVBQ3BDLGlCQUFtQztRQURuQyxnQkFBVyxHQUFYLFdBQVcsQ0FBeUI7UUFDcEMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFrQjtRQTFCN0MscURBQXFEO1FBRTlDLDBCQUFxQixHQUFxQixRQUFRLENBQUM7UUFVMUQsK0RBQStEO1FBRXhELGVBQVUsR0FBRyxLQUFLLENBQUM7UUFheEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUU7WUFDcEYsTUFBTSxDQUFDLHFCQUFxQixDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ25ELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELG1FQUFtRTtJQUM1RCxJQUFJO1FBQ1QsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFD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QUFDO0lBQ2YsQ0FBQzs4R0F2R1UsZ0JBQWdCO2tHQUFoQixnQkFBZ0I7OzJGQUFoQixnQkFBZ0I7a0JBSjVCLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLGdCQUFnQjtvQkFDMUIsUUFBUSxFQUFFLGNBQWM7aUJBQ3pCOzhHQU9RLFlBQVk7c0JBRGxCLEtBQUs7Z0JBS0MscUJBQXFCO3NCQUQzQixLQUFLO2dCQU9LLHVCQUF1QjtzQkFEakMsS0FBSztnQkFPQyxVQUFVO3NCQURoQixLQUFLO2dCQUtDLGlCQUFpQjtzQkFEdkIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgSW5wdXQsIEVsZW1lbnRSZWYsIFRlbXBsYXRlUmVmLCBWaWV3Q29udGFpbmVyUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPbkRlc3Ryb3ksIEVtYmVkZGVkVmlld1JlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUE9QT1ZFUl9DT05TVEFOVFMsIE92ZXJsYXlQbGFjZW1lbnQsIFBvcG92ZXJDb21wb25lbnQgfSBmcm9tICdAdHlsZXJ0ZWNoL2ZvcmdlJztcblxuLyoqXG4gKiBBbGxvd3MgZm9yIGRlY2xhcmF0aXZlbHkgc3BlY2lmeWluZyBhbiBlbGVtZW50IHRoYXQgc2hvdWxkIGRpc3BsYXkgYSBGb3JnZSBwb3BvdmVyXG4gKiBmcm9tIHRoZSBwcm92aWRlZCBgVGVtcGxhdGVSZWZgLlxuICovXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbZm9yZ2VQb3BvdmVyXScsXG4gIGV4cG9ydEFzOiAnZm9yZ2VQb3BvdmVyJ1xufSlcbmV4cG9ydCBjbGFzcyBQb3BvdmVyRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgcHJpdmF0ZSBfcG9wb3ZlckVsZW1lbnQ/OiBQb3BvdmVyQ29tcG9uZW50O1xuICBwcml2YXRlIF9jb250ZW50UmVmPzogRW1iZWRkZWRWaWV3UmVmPGFueT47XG5cbiAgLyoqIFRoZSBUZW1wbGF0ZVJlZiB0byB1c2UgYXMgdGhlIGVtYmVkZGVkIHZpZXcgZm9yIHRoZSBwb3BvdmVyLiAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgZm9yZ2VQb3BvdmVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIC8qKiBUaGUgcG9wb3ZlciBwbGFjZW1lbnQgYXJvdW5kIHRoZSBgRWxlbWVudFJlZmAuICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBmb3JnZVBvcG92ZXJQbGFjZW1lbnQ6IE92ZXJsYXlQbGFjZW1lbnQgPSAnYm90dG9tJztcblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWQgVXNlIHN0YXRpYyBwcm9wZXJ0eSBpbnN0ZWFkLlxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNldCBmb3JnZVBvcG92ZXJDbG9zZU9uQmx1cih2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMucGVyc2lzdGVudCA9ICF2YWx1ZTtcbiAgfVxuXG4gIC8qKiBDb250cm9scyB3aGV0aGVyIHRoZSBwb3BvdmVyIGNsb3NlcyB3aGVuIGl0IGxvc2VzIGZvY3VzLiAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgcGVyc2lzdGVudCA9IGZhbHNlO1xuXG4gIC8qKiBBZGRzIGEgY3VzdG9tIGNsYXNzIHRoZSBgPGZvcmdlLXBvcG92ZXI+YCBlbGVtZW50IHRoYXQgaXMgY3JlYXRlZCBieSB0aGlzIGRpcmVjdGl2ZS4gKi9cbiAgQElucHV0KClcbiAgcHVibGljIGZvcmdlUG9wb3ZlckNsYXNzOiBzdHJpbmc7XG5cbiAgcHVibGljIGdldCBwb3BvdmVyRWxlbWVudCgpOiBIVE1MRWxlbWVudCB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuX3BvcG92ZXJFbGVtZW50O1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfZWxlbWVudFJlZjogRWxlbWVudFJlZjxIVE1MRWxlbWVudD4sXG4gICAgcHJpdmF0ZSBfdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZikge1xuICAgIHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFBPUE9WRVJfQ09OU1RBTlRTLmV2ZW50cy5UT0dHTEUsICgpID0+IHtcbiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5jbG9zZSgpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKiBDcmVhdGVzIGFuZCByZW5kZXJzIGEgVGVtcGxhdGVSZWYgaW5zaWRlIG9mIGEgRm9yZ2UgcG9wb3Zlci4gKi9cbiAgcHVibGljIG9wZW4oKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX3BvcG92ZXJFbGVtZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gRW5zdXJlIHRoYXQgd2UgaGF2ZSBhIHBvcG92ZXIgdGVtcGxhdGVcbiAgICBpZiAodGhpcy5mb3JnZVBvcG92ZXIgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZiA9PT0gZmFsc2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUG9wb3ZlciB0ZW1wbGF0ZSBpcyBub3QgZGVmaW5lZC4nKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgdGhlIGVtYmVkZGVkIHZpZXcgZnJvbSB0aGUgdGVtcGxhdGVcbiAgICB0aGlzLl9jb250ZW50UmVmID0gdGhpcy5fdmlld0NvbnRhaW5lclJlZi5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy5mb3JnZVBvcG92ZXIpO1xuXG4gICAgaWYgKHRoaXMuX2NvbnRlbnRSZWYucm9vdE5vZGVzWzBdIGluc3RhbmNlb2YgUG9wb3ZlckNvbXBvbmVudCkge1xuICAgICAgLy8gPGZvcmdlLXBvcG92ZXI+IGVsZW1lbnQgaXMgc3VwcGxpZWQgaW4gdGhlIHRlbXBsYXRlXG4gICAgICB0aGlzLl9wb3BvdmVyRWxlbWVudCA9IHRoaXMuX2NvbnRlbnRSZWYucm9vdE5vZGVzWzBdIGFzIFBvcG92ZXJDb21wb25lbnQ7XG4gICAgICB0aGlzLl9wb3BvdmVyRWxlbWVudC5yZW1vdmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ3JlYXRlIHRoZSBGb3JnZSBwb3BvdmVyIGVsZW1lbnRcbiAgICAgIHRoaXMuX3BvcG92ZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9yZ2UtcG9wb3ZlcicpIGFzIFBvcG92ZXJDb21wb25lbnQ7XG5cbiAgICAgIC8vIEJlY2F1c2UgY3JlYXRlRW1iZWRkZWRWaWV3IHdpbGwgcGxhY2UgdGhlIHRlbXBsYXRlIHdpdGhpbiB0aGUgZWxlbWVudCBkZWZpbmVkIGJ5IFZpZXdDb250YWluZXJSZWYsIHdlXG4gICAgICAvLyBuZWVkIHRvIHRoZW4gbW92ZSB0aGUgZWxlbWVudHMgdG8gY2hpbGRyZW4gb2YgdGhlIEZvcmdlIHBvcG92ZXIgZWxlbWVudCBzbyB0aGV5IHJlbmRlciB3aXRoaW4gdGhlIHBvcG92ZXJcbiAgICAgIHRoaXMuX2NvbnRlbnRSZWYucm9vdE5vZGVzLmZvckVhY2gobm9kZSA9PiB0aGlzLl9wb3BvdmVyRWxlbWVudD8uYXBwZW5kQ2hpbGQobm9kZSkpO1xuXG4gICAgICB0aGlzLl9wb3BvdmVyRWxlbWVudC5wbGFjZW1lbnQgPSB0aGlzLmZvcmdlUG9wb3ZlclBsYWNlbWVudDtcblxuICAgICAgLy8gQWRkIHRoZSBjdXN0b20gY2xhc3MgKGlmIHByb3ZpZGVkKVxuICAgICAgaWYgKHRoaXMuZm9yZ2VQb3BvdmVyQ2xhc3MpIHtcbiAgICAgICAgdGhpcy5fcG9wb3ZlckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmZvcmdlUG9wb3ZlckNsYXNzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fcG9wb3ZlckVsZW1lbnQucGVyc2lzdGVudCA9IHRoaXMucGVyc2lzdGVudDtcbiAgICB9XG5cbiAgICBsZXQgaG9zdEVsZW1lbnQ6IEVsZW1lbnQgfCBTaGFkb3dSb290IHwgbnVsbCA9IHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbG9zZXN0KFBPUE9WRVJfQ09OU1RBTlRTLnNlbGVjdG9ycy5IT1NUKTtcbiAgICBpZiAoIWhvc3RFbGVtZW50KSB7XG4gICAgICBjb25zdCByb290Tm9kZSA9IHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRSb290Tm9kZSgpO1xuICAgICAgY29uc3QgaG9zdFJvb3ROb2RlID0gcm9vdE5vZGUgaW5zdGFuY2VvZiBTaGFkb3dSb290ID8gcm9vdE5vZGUgOiAodGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lm93bmVyRG9jdW1lbnQgPz8gZG9jdW1lbnQpLmJvZHk7XG4gICAgICBob3N0RWxlbWVudCA9IGhvc3RSb290Tm9kZTtcbiAgICB9XG5cbiAgICBob3N0RWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9wb3BvdmVyRWxlbWVudCk7XG4gICAgdGhpcy5fcG9wb3ZlckVsZW1lbnQuYW5jaG9yRWxlbWVudCA9IHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcbiAgICB0aGlzLl9wb3BvdmVyRWxlbWVudC5vcGVuID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKiBDbG9zZXMgdGhlIEZvcmdlIHBvcG92ZXIgYW5kIGRlc3Ryb3lzIHRoZSBlbWJlZGRlZCB2aWV3LiAqL1xuICBwdWJsaWMgY2xvc2UoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX3BvcG92ZXJFbGVtZW50KSB7XG4gICAgICB0aGlzLl9wb3BvdmVyRWxlbWVudC5vcGVuID0gZmFsc2U7XG4gICAgICB0aGlzLl9wb3BvdmVyRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fY29udGVudFJlZikge1xuICAgICAgdGhpcy5fY29udGVudFJlZi5kZXN0cm95KCk7XG4gICAgICB0aGlzLl9jb250ZW50UmVmID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cbn1cbiJdfQ==